# å±€åŸŸç½‘è®¿é—® + é£ä¹¦å‘Šè­¦ä½¿ç”¨æŒ‡å—

## ğŸ“¡ ä¸€ã€å±€åŸŸç½‘è®¿é—®é…ç½®

### å½“å‰çŠ¶æ€

**é»˜è®¤é…ç½®**:
```yaml
web:
  host: "localhost"  # ä»…æœ¬åœ°è®¿é—®
  port: "18080"
```

**è®¿é—®é™åˆ¶**: âŒ å±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡æ— æ³•è®¿é—®

---

### âœ… å¯ç”¨å±€åŸŸç½‘è®¿é—®

#### æ–¹æ³•1: ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰

```yaml
# ~/.process-tracker/config.yaml
web:
  enabled: true
  host: "0.0.0.0"    # ç›‘å¬æ‰€æœ‰ç½‘å¡ï¼Œå…è®¸å±€åŸŸç½‘è®¿é—®
  port: "18080"
```

ç„¶åå¯åŠ¨ï¼š
```bash
./process-tracker web
```

#### æ–¹æ³•2: å‘½ä»¤è¡Œå‚æ•°

```bash
# ç›´æ¥æŒ‡å®šhostå’Œport
./process-tracker web --host 0.0.0.0 --port 18080
```

#### æ–¹æ³•3: å¯åŠ¨ç›‘æ§æ—¶åŒæ—¶å¯ç”¨Web

```bash
./process-tracker start --web --web-port 18080
# éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„hostä¸º0.0.0.0
```

---

### ğŸŒ å±€åŸŸç½‘è®¿é—®æ­¥éª¤

**1. å¯åŠ¨æœåŠ¡ï¼ˆç›‘å¬æ‰€æœ‰ç½‘å¡ï¼‰**
```bash
./process-tracker web --host 0.0.0.0 --port 18080
```

**è¾“å‡ºç¤ºä¾‹**:
```
WebæœåŠ¡å™¨å¯åŠ¨: http://0.0.0.0:18080
```

**2. æŸ¥çœ‹æœåŠ¡å™¨IPåœ°å€**
```bash
# æŸ¥çœ‹æœ¬æœºIP
ip addr show | grep "inet " | grep -v "127.0.0.1"
# æˆ–
hostname -I
```

å‡è®¾è¾“å‡º: `192.168.1.100`

**3. å±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡è®¿é—®**
```
æµè§ˆå™¨æ‰“å¼€: http://192.168.1.100:18080
```

**4. éªŒè¯ç«¯å£ç›‘å¬**
```bash
# ç¡®è®¤ç«¯å£æ­£åœ¨ç›‘å¬æ‰€æœ‰æ¥å£
ss -tlnp | grep 18080
# æˆ–
netstat -tlnp | grep 18080
```

åº”è¯¥çœ‹åˆ°ï¼š
```
tcp   0   0  0.0.0.0:18080    0.0.0.0:*    LISTEN
```

---

### ğŸ”’ å®‰å…¨å»ºè®®

âš ï¸ **è­¦å‘Š**: ä½¿ç”¨ `0.0.0.0` ä¼šè®©å±€åŸŸç½‘å†…æ‰€æœ‰è®¾å¤‡éƒ½èƒ½è®¿é—®

**å»ºè®®å®‰å…¨æªæ–½**:

1. **é˜²ç«å¢™é…ç½®**
   ```bash
   # Ubuntu/Debian
   sudo ufw allow from 192.168.1.0/24 to any port 18080
   
   # CentOS/RHEL
   sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="18080" accept'
   sudo firewall-cmd --reload
   ```

2. **ä½¿ç”¨éæ ‡å‡†ç«¯å£**
   - å·²ä½¿ç”¨18080ï¼Œé¿å…å¸¸è§æ”»å‡»

3. **ä»…å†…ç½‘ç¯å¢ƒä½¿ç”¨**
   - ä¸è¦æš´éœ²åˆ°å…¬ç½‘
   - ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Nginxåå‘ä»£ç† + SSL

4. **æ·»åŠ åŸºç¡€è®¤è¯**ï¼ˆæœªæ¥åŠŸèƒ½ï¼‰
   - è®¡åˆ’åœ¨v0.5.0æ·»åŠ HTTP Basic Auth

---

## ğŸ”” äºŒã€é£ä¹¦å‘Šè­¦è§¦å‘æœºåˆ¶

### å‘Šè­¦è§¦å‘æ¡ä»¶

**é£ä¹¦é€šçŸ¥ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘é€**:

```
æ¡ä»¶1: å‘Šè­¦ç³»ç»Ÿå·²å¯ç”¨ (alerts.enabled = true)
  â†“
æ¡ä»¶2: é…ç½®äº†å‘Šè­¦è§„åˆ™
  â†“
æ¡ä»¶3: ç›‘æ§æŒ‡æ ‡è¶…è¿‡é˜ˆå€¼ (å¦‚CPU > 80%)
  â†“
æ¡ä»¶4: æŒç»­è¶…è¿‡æŒ‡å®šæ—¶é—´ (å¦‚æŒç»­5åˆ†é’Ÿ)
  â†“
æ¡ä»¶5: ä¸åœ¨æŠ‘åˆ¶æœŸå†… (é»˜è®¤30åˆ†é’ŸæŠ‘åˆ¶æœŸ)
  â†“
è§¦å‘: å‘é€é£ä¹¦é€šçŸ¥ âœ…
```

---

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# ~/.process-tracker/config.yaml

# Webé…ç½® - å±€åŸŸç½‘è®¿é—®
web:
  enabled: true
  host: "0.0.0.0"     # å…è®¸å±€åŸŸç½‘è®¿é—®
  port: "18080"

# å‘Šè­¦é…ç½®
alerts:
  enabled: true       # âš ï¸ å¿…é¡»è®¾ç½®ä¸ºtrue
  suppress_duration: 30  # æŠ‘åˆ¶æ—¶é•¿(åˆ†é’Ÿ)
  
  rules:
    # è§„åˆ™1: CPUé«˜è´Ÿè½½å‘Šè­¦
    - name: high_cpu_alert
      enabled: true
      metric: cpu_percent      # ç›‘æ§CPUä½¿ç”¨ç‡
      threshold: 80            # é˜ˆå€¼80%
      duration: 300            # æŒç»­5åˆ†é’Ÿ(300ç§’)
      channels: ["feishu"]     # é€šè¿‡é£ä¹¦é€šçŸ¥
    
    # è§„åˆ™2: å†…å­˜é«˜å ç”¨å‘Šè­¦
    - name: high_memory_alert
      enabled: true
      metric: memory_mb        # ç›‘æ§å†…å­˜(MB)
      threshold: 1024          # é˜ˆå€¼1GB
      duration: 300            # æŒç»­5åˆ†é’Ÿ
      channels: ["feishu"]
    
    # è§„åˆ™3: ç‰¹å®šè¿›ç¨‹å‘Šè­¦
    - name: docker_high_cpu
      enabled: true
      metric: cpu_percent
      threshold: 50
      duration: 180            # æŒç»­3åˆ†é’Ÿ
      process: "docker"        # åªç›‘æ§dockerè¿›ç¨‹
      channels: ["feishu"]

# é€šçŸ¥å™¨é…ç½®
notifiers:
  feishu:
    webhook_url: "${WEBHOOK_URL}"  # ä»ç¯å¢ƒå˜é‡è¯»å–
```

---

### å‘Šè­¦å·¥ä½œæµç¨‹

#### 1. ç›‘æ§å¾ªç¯

```
æ¯5ç§’æ‰§è¡Œä¸€æ¬¡:
  â†“
é‡‡é›†è¿›ç¨‹æ•°æ® (CPU, å†…å­˜, ç­‰)
  â†“
è¯„ä¼°å‘Šè­¦è§„åˆ™ âš ï¸ (éœ€è¦é›†æˆ)
  â†“
å¦‚æœè¶…è¿‡é˜ˆå€¼: æ›´æ–°å‘Šè­¦çŠ¶æ€
  â†“
å¦‚æœæŒç»­æ—¶é—´æ»¡è¶³: å‘é€é€šçŸ¥
```

#### 2. å‘Šè­¦çŠ¶æ€æœº

```
åˆå§‹çŠ¶æ€: æ— å‘Šè­¦
  â†“
[CPU > 80%] â†’ å¼€å§‹è®¡æ—¶
  â†“
[æŒç»­1åˆ†é’Ÿ] â†’ ç»§ç»­è®¡æ—¶
  â†“
[æŒç»­5åˆ†é’Ÿ] â†’ è§¦å‘å‘Šè­¦ â†’ å‘é€é£ä¹¦é€šçŸ¥ ğŸ“¨
  â†“
[CPUæ¢å¤æ­£å¸¸] â†’ å‘é€æ¢å¤é€šçŸ¥ â†’ é‡ç½®çŠ¶æ€
```

#### 3. å‘Šè­¦æŠ‘åˆ¶

```
ç¬¬ä¸€æ¬¡é€šçŸ¥: ç«‹å³å‘é€ âœ…
  â†“
æŠ‘åˆ¶æœŸå¼€å§‹ (30åˆ†é’Ÿ)
  â†“
æœŸé—´å³ä½¿å†æ¬¡è§¦å‘: ä¸å‘é€ âŒ
  â†“
30åˆ†é’Ÿå: å¯ä»¥å†æ¬¡å‘é€ âœ…
```

---

### âš ï¸ é‡è¦ï¼šå½“å‰é™åˆ¶

**å‘Šè­¦ç³»ç»Ÿå°šæœªå®Œå…¨é›†æˆ**

å½“å‰çŠ¶æ€ï¼š
- âœ… å‘Šè­¦å¼•æ“å·²å®ç° (`core/alerting.go`)
- âœ… é£ä¹¦é€šçŸ¥å™¨å·²å®ç° (`core/feishu_notifier.go`)
- âœ… é…ç½®åŠ è½½å·²å®ç°
- âŒ **æœªé›†æˆåˆ°ç›‘æ§å¾ªç¯** âš ï¸

**éœ€è¦æ·»åŠ çš„ä»£ç ** (åœ¨ `core/app.go` ä¸­):

```go
// åœ¨ç›‘æ§å¾ªç¯ä¸­æ·»åŠ  (å¤§çº¦ç¬¬200è¡Œ)
func (a *App) Run() error {
    // ... ç°æœ‰ä»£ç  ...
    
    for {
        // é‡‡é›†è¿›ç¨‹æ•°æ®
        records := a.collectProcessData()
        
        // ğŸ†• æ·»åŠ å‘Šè­¦è¯„ä¼°
        if a.alertManager != nil {
            a.alertManager.Evaluate(records)
        }
        
        // ... å…¶ä»–é€»è¾‘ ...
    }
}
```

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1: é…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºå®Œæ•´é…ç½®
cat > ~/.process-tracker/config.yaml << 'EOF'
web:
  enabled: true
  host: "0.0.0.0"      # å±€åŸŸç½‘è®¿é—®
  port: "18080"

storage:
  max_size_mb: 100
  keep_days: 7

alerts:
  enabled: true
  suppress_duration: 30
  
  rules:
    # ä½é˜ˆå€¼ä¾¿äºæµ‹è¯•
    - name: test_cpu_alert
      enabled: true
      metric: cpu_percent
      threshold: 10       # ä½é˜ˆå€¼10%ï¼Œå®¹æ˜“è§¦å‘
      duration: 10        # 10ç§’åè§¦å‘
      channels: ["feishu"]

notifiers:
  feishu:
    webhook_url: "${WEBHOOK_URL}"
EOF
```

### æ­¥éª¤2: å¯åŠ¨æœåŠ¡

```bash
# ç¡®ä¿ç¯å¢ƒå˜é‡å·²è®¾ç½®
echo $WEBHOOK_URL

# å¯åŠ¨Web + ç›‘æ§
./process-tracker web
```

### æ­¥éª¤3: æµ‹è¯•å±€åŸŸç½‘è®¿é—®

**åœ¨æœåŠ¡å™¨ä¸Š**:
```bash
# æŸ¥çœ‹IP
hostname -I
# å‡è®¾è¾“å‡º: 192.168.1.100
```

**åœ¨å±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡**:
```
æµè§ˆå™¨æ‰“å¼€: http://192.168.1.100:18080
```

åº”è¯¥èƒ½çœ‹åˆ°Dashboardç•Œé¢

### æ­¥éª¤4: æµ‹è¯•é£ä¹¦å‘Šè­¦

**æ–¹æ³•A: ä½¿ç”¨æµ‹è¯•å·¥å…·**
```bash
go run test_webhook.go
# åº”è¯¥ç«‹å³æ”¶åˆ°é£ä¹¦é€šçŸ¥
```

**æ–¹æ³•B: è§¦å‘å®é™…å‘Šè­¦** (éœ€è¦é›†æˆå)
```bash
# æ¨¡æ‹Ÿé«˜CPU
stress --cpu 2 --timeout 30s

# æˆ–
yes > /dev/null &
# è®°ä½PIDï¼Œæµ‹è¯•åæ‰§è¡Œ: kill <PID>
```

10ç§’ååº”è¯¥æ”¶åˆ°é£ä¹¦å‘Šè­¦

---

## ğŸ“Š å½“å‰åŠŸèƒ½çŠ¶æ€

### Webå±€åŸŸç½‘è®¿é—®

| åŠŸèƒ½ | çŠ¶æ€ | é…ç½® |
|------|------|------|
| æœ¬åœ°è®¿é—® | âœ… | host: "localhost" |
| å±€åŸŸç½‘è®¿é—® | âœ… | host: "0.0.0.0" |
| å‘½ä»¤è¡ŒæŒ‡å®š | âœ… | --host 0.0.0.0 |
| ç«¯å£é…ç½® | âœ… | --port 18080 |

### é£ä¹¦å‘Šè­¦

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| é£ä¹¦é€šçŸ¥å™¨ | âœ… | å·²å®ç° |
| ç¯å¢ƒå˜é‡æ”¯æŒ | âœ… | ${WEBHOOK_URL} |
| å‘Šè­¦å¼•æ“ | âœ… | å·²å®ç° |
| è§„åˆ™é…ç½® | âœ… | YAMLé…ç½® |
| æµ‹è¯•å·¥å…· | âœ… | test_webhook.go |
| **ç›‘æ§é›†æˆ** | âš ï¸ | **éœ€è¦30åˆ†é’Ÿé›†æˆ** |

---

## ğŸš€ ç«‹å³å¯ç”¨å‘½ä»¤

### å±€åŸŸç½‘Webè®¿é—®

```bash
# å¯åŠ¨WebæœåŠ¡å™¨ï¼ˆå±€åŸŸç½‘å¯è®¿é—®ï¼‰
./process-tracker web --host 0.0.0.0 --port 18080

# è®¿é—®åœ°å€ï¼ˆæ›¿æ¢ä¸ºå®é™…IPï¼‰
# http://YOUR_SERVER_IP:18080
```

### æµ‹è¯•é£ä¹¦é€šçŸ¥

```bash
# ç›´æ¥æµ‹è¯•é£ä¹¦é€šçŸ¥
go run test_webhook.go

# æˆ–ä½¿ç”¨è„šæœ¬
./test_webhook.sh
```

---

## ğŸ’¡ å®ç”¨é…ç½®æ¨¡æ¿

### å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ°è®¿é—®ï¼‰

```yaml
web:
  enabled: true
  host: "localhost"
  port: "18080"

alerts:
  enabled: false  # å¼€å‘æ—¶å…³é—­å‘Šè­¦
```

### æµ‹è¯•ç¯å¢ƒï¼ˆå±€åŸŸç½‘è®¿é—®+å‘Šè­¦ï¼‰

```yaml
web:
  enabled: true
  host: "0.0.0.0"
  port: "18080"

alerts:
  enabled: true
  suppress_duration: 5  # çŸ­æŠ‘åˆ¶æœŸä¾¿äºæµ‹è¯•
  
  rules:
    - name: test_alert
      metric: cpu_percent
      threshold: 10      # ä½é˜ˆå€¼
      duration: 10       # 10ç§’
      channels: ["feishu"]

notifiers:
  feishu:
    webhook_url: "${WEBHOOK_URL}"
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆå®‰å…¨é…ç½®ï¼‰

```yaml
web:
  enabled: true
  host: "127.0.0.1"    # ä»…æœ¬åœ°ï¼Œé€šè¿‡Nginxä»£ç†
  port: "18080"

alerts:
  enabled: true
  suppress_duration: 30
  
  rules:
    - name: critical_cpu
      metric: cpu_percent
      threshold: 80
      duration: 300      # 5åˆ†é’Ÿ
      channels: ["feishu"]
    
    - name: critical_memory
      metric: memory_mb
      threshold: 4096    # 4GB
      duration: 300
      channels: ["feishu"]

notifiers:
  feishu:
    webhook_url: "${WEBHOOK_URL}"
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å±€åŸŸç½‘æ— æ³•è®¿é—®

**é—®é¢˜**: å…¶ä»–è®¾å¤‡è®¿é—®ä¸äº†Dashboard

**æ£€æŸ¥æ¸…å•**:
```bash
# 1. ç¡®è®¤hosté…ç½®
cat ~/.process-tracker/config.yaml | grep "host:"
# åº”è¯¥æ˜¯: host: "0.0.0.0"

# 2. ç¡®è®¤ç«¯å£ç›‘å¬
ss -tlnp | grep 18080
# åº”è¯¥çœ‹åˆ°: 0.0.0.0:18080

# 3. æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://localhost:18080/api/health

# 4. æµ‹è¯•å±€åŸŸç½‘è®¿é—®ï¼ˆåœ¨å¦ä¸€å°æœºå™¨ï¼‰
curl http://SERVER_IP:18080/api/health

# 5. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status | grep 18080
# æˆ–
sudo firewall-cmd --list-ports | grep 18080
```

### é£ä¹¦é€šçŸ¥ä¸å‘é€

**é—®é¢˜**: æ²¡æœ‰æ”¶åˆ°é£ä¹¦é€šçŸ¥

**æ£€æŸ¥æ¸…å•**:
```bash
# 1. æµ‹è¯•Webhook URL
go run test_webhook.go

# 2. ç¡®è®¤ç¯å¢ƒå˜é‡
echo $WEBHOOK_URL

# 3. ç¡®è®¤å‘Šè­¦å·²å¯ç”¨
cat ~/.process-tracker/config.yaml | grep -A2 "alerts:"

# 4. ç¡®è®¤è§„åˆ™é…ç½®
cat ~/.process-tracker/config.yaml | grep -A5 "rules:"

# 5. æŸ¥çœ‹æ—¥å¿—
./process-tracker start
# æŸ¥çœ‹æ˜¯å¦æœ‰"å‘Šè­¦å·²å‘é€"çš„æ—¥å¿—
```

---

## ğŸ“ æ€»ç»“

### å±€åŸŸç½‘è®¿é—®

âœ… **æ”¯æŒ**: é…ç½® `host: "0.0.0.0"`  
âœ… **æ–¹æ³•**: é…ç½®æ–‡ä»¶æˆ–å‘½ä»¤è¡Œå‚æ•°  
âœ… **å®‰å…¨**: å»ºè®®é…ç½®é˜²ç«å¢™  

### é£ä¹¦å‘Šè­¦è§¦å‘æ—¶æœº

âœ… **æ¡ä»¶1**: alerts.enabled = true  
âœ… **æ¡ä»¶2**: é…ç½®äº†å‘Šè­¦è§„åˆ™  
âœ… **æ¡ä»¶3**: CPU/å†…å­˜è¶…è¿‡é˜ˆå€¼  
âœ… **æ¡ä»¶4**: æŒç»­è¶…è¿‡æŒ‡å®šæ—¶é—´  
âš ï¸ **é™åˆ¶**: éœ€è¦é›†æˆåˆ°ç›‘æ§å¾ªç¯ï¼ˆ30åˆ†é’Ÿå·¥ä½œï¼‰

### ç«‹å³å¯æµ‹è¯•

```bash
# 1. å±€åŸŸç½‘Webè®¿é—®
./process-tracker web --host 0.0.0.0 --port 18080

# 2. é£ä¹¦é€šçŸ¥æµ‹è¯•
go run test_webhook.go
```

---

*æ›´æ–°æ—¶é—´: 2025å¹´1æœˆ*  
*çŠ¶æ€: âœ… å±€åŸŸç½‘æ”¯æŒå®Œæ•´*  
*çŠ¶æ€: âš ï¸ å‘Šè­¦éœ€30åˆ†é’Ÿé›†æˆ*
