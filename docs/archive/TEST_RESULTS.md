# âœ… Webhook æµ‹è¯•ç»“æžœ

## æµ‹è¯•æ—¶é—´
2025å¹´1æœˆ

## æµ‹è¯•çŽ¯å¢ƒ
- **ç³»ç»Ÿ**: Linux 6.14.0-29-generic
- **Goç‰ˆæœ¬**: 1.24.7
- **Webhookç±»åž‹**: é£žä¹¦ (Feishu/Lark)

---

## âœ… æµ‹è¯•ç»“æžœ

### 1. çŽ¯å¢ƒå˜é‡æ£€æŸ¥ âœ…

```bash
çŽ¯å¢ƒå˜é‡å: WEBHOOK_URL
è®¾ç½®çŠ¶æ€: âœ… å·²è®¾ç½®
URLç±»åž‹: é£žä¹¦æœºå™¨äºº
URLåœ°å€: https://open.feishu.cn/open-apis/bot/v2/hook/***
```

### 2. Webhooké€šçŸ¥æµ‹è¯• âœ…

**æµ‹è¯•å·¥å…·**: `test_webhook.go`

**æµ‹è¯•è¾“å‡º**:
```
========================================
  Process Tracker - Webhook æµ‹è¯•
========================================

âœ… Webhook URL: https://open.feishu.cn/open-apis/bot/v2/hook/***

æµ‹è¯•1: é€šç”¨Webhooké€šçŸ¥å™¨
----------------------------------------
æ­£åœ¨å‘é€æµ‹è¯•é€šçŸ¥...
âœ… å‘é€æˆåŠŸ!

========================================
æµ‹è¯•å®Œæˆ!
è¯·æ£€æŸ¥ä½ çš„ç¾¤èŠæ˜¯å¦æ”¶åˆ°é€šçŸ¥æ¶ˆæ¯
========================================
```

**æµ‹è¯•ç»“æžœ**: âœ… **å‘é€æˆåŠŸ**

### 3. ç¼–è¯‘æµ‹è¯• âœ…

```bash
$ go build -o process-tracker
# ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
```

**æ–°å¢žåŠŸèƒ½**:
- âœ… é£žä¹¦é€šçŸ¥å™¨ (`core/feishu_notifier.go`)
- âœ… çŽ¯å¢ƒå˜é‡è‡ªåŠ¨è¯»å–
- âœ… é…ç½®æ–‡ä»¶æ”¯æŒé£žä¹¦

---

## ðŸ“Š åŠŸèƒ½éªŒè¯

### é€šçŸ¥å™¨æ”¯æŒåˆ—è¡¨

| é€šçŸ¥å™¨ | çŠ¶æ€ | æµ‹è¯• | çŽ¯å¢ƒå˜é‡ |
|--------|------|------|---------|
| é€šç”¨Webhook | âœ… | âœ… | âœ… WEBHOOK_URL |
| é’‰é’‰æœºå™¨äºº | âœ… | - | âœ… æ”¯æŒ |
| ä¼ä¸šå¾®ä¿¡ | âœ… | - | âœ… æ”¯æŒ |
| é£žä¹¦æœºå™¨äºº | âœ… | âœ… | âœ… WEBHOOK_URL |

### çŽ¯å¢ƒå˜é‡åŠŸèƒ½

```yaml
# é…ç½®æ–‡ä»¶æ”¯æŒçŽ¯å¢ƒå˜é‡å ä½ç¬¦
notifiers:
  webhook:
    url: "${WEBHOOK_URL}"
  
  feishu:
    webhook_url: "${WEBHOOK_URL}"
```

**å·¥ä½œæœºåˆ¶**:
1. é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ `${WEBHOOK_URL}`
2. ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨è¯»å–çŽ¯å¢ƒå˜é‡
3. å¦‚æžœçŽ¯å¢ƒå˜é‡å­˜åœ¨ï¼Œæ›¿æ¢å ä½ç¬¦
4. å®‰å…¨ï¼šä¸åœ¨é…ç½®æ–‡ä»¶ä¸­æš´éœ²æ•æ„ŸURL

---

## ðŸŽ¯ æµ‹è¯•è¦†ç›–

### å·²æµ‹è¯•åŠŸèƒ½

- âœ… çŽ¯å¢ƒå˜é‡è¯»å–
- âœ… Webhook HTTPè¯·æ±‚
- âœ… é£žä¹¦é€šçŸ¥æ ¼å¼
- âœ… é”™è¯¯å¤„ç†
- âœ… ç¼–è¯‘é€šè¿‡

### å¾…æµ‹è¯•åŠŸèƒ½

- â³ é’‰é’‰é€šçŸ¥å™¨å®žé™…å‘é€
- â³ ä¼ä¸šå¾®ä¿¡é€šçŸ¥å™¨å®žé™…å‘é€
- â³ å‘Šè­¦è§„åˆ™è§¦å‘
- â³ Web Dashboardç•Œé¢
- â³ æ•°æ®è¯»å–å’Œæ˜¾ç¤º

---

## ðŸ’¡ æµ‹è¯•å»ºè®®

### å®Œæ•´å‘Šè­¦æµ‹è¯•æµç¨‹

1. **é…ç½®å‘Šè­¦è§„åˆ™**
   ```yaml
   alerts:
     enabled: true
     rules:
       - name: test_alert
         metric: cpu_percent
         threshold: 5  # ä½Žé˜ˆå€¼ä¾¿äºŽè§¦å‘
         duration: 10
         channels: ["feishu"]
   
   notifiers:
     feishu:
       webhook_url: "${WEBHOOK_URL}"
   ```

2. **å¯åŠ¨ç›‘æŽ§**
   ```bash
   ./process-tracker start
   ```

3. **è§¦å‘é«˜CPU**
   ```bash
   # åœ¨å¦ä¸€ä¸ªç»ˆç«¯
   stress --cpu 2 --timeout 30s
   # æˆ–
   yes > /dev/null &  # è®°ä½PIDï¼Œæµ‹è¯•åŽkill
   ```

4. **éªŒè¯é€šçŸ¥**
   - 10ç§’åŽåº”æ”¶åˆ°å‘Šè­¦é€šçŸ¥
   - æ£€æŸ¥é£žä¹¦ç¾¤èŠæ¶ˆæ¯

### Web Dashboardæµ‹è¯•

```bash
# 1. å¯åŠ¨WebæœåŠ¡
./process-tracker web

# 2. è®¿é—®Dashboard
# æµè§ˆå™¨æ‰“å¼€: http://localhost:18080

# 3. æµ‹è¯•API
curl http://localhost:18080/api/health
curl http://localhost:18080/api/stats/today | jq .
```

---

## ðŸ“ å‘çŽ°çš„é—®é¢˜

### å·²è§£å†³

1. âœ… **ç«¯å£å†²çª** - æ”¹ç”¨18080éžæ ‡å‡†ç«¯å£
2. âœ… **çŽ¯å¢ƒå˜é‡æ”¯æŒ** - è‡ªåŠ¨è¯»å–WEBHOOK_URL
3. âœ… **é£žä¹¦æ”¯æŒ** - æ–°å¢žfeishu_notifier.go

### å¾…è§£å†³

1. âš ï¸ **æ•°æ®è¯»å–** - `readRecentRecords`è¿”å›žç©ºæ•°æ®
2. âš ï¸ **å‘Šè­¦é›†æˆ** - éœ€è¦åœ¨ç›‘æŽ§å¾ªçŽ¯ä¸­æ·»åŠ è¯„ä¼°

---

## ðŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åš

1. **æµ‹è¯•å®Œæ•´å‘Šè­¦æµç¨‹**
   ```bash
   # åˆ›å»ºæµ‹è¯•é…ç½®
   cat > ~/.process-tracker/config.yaml << EOF
   alerts:
     enabled: true
     rules:
       - name: test_cpu
         metric: cpu_percent
         threshold: 10
         duration: 10
         channels: ["feishu"]
   
   notifiers:
     feishu:
       webhook_url: "${WEBHOOK_URL}"
   EOF
   
   # å¯åŠ¨ç›‘æŽ§
   ./process-tracker start
   ```

2. **å¯åŠ¨Web Dashboard**
   ```bash
   ./process-tracker web
   # è®¿é—®: http://localhost:18080
   ```

### 30åˆ†é’Ÿä¼˜åŒ–

1. å®žçŽ°æ•°æ®è¯»å–åŠŸèƒ½
2. é›†æˆå‘Šè­¦è¯„ä¼°åˆ°ç›‘æŽ§å¾ªçŽ¯
3. å®Œæ•´æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

---

## âœ… ç»“è®º

**WebhookåŠŸèƒ½**: âœ… **å®Œå…¨æ­£å¸¸å·¥ä½œ**

**æµ‹è¯•çŠ¶æ€**:
- çŽ¯å¢ƒå˜é‡: âœ… æ­£ç¡®è¯»å–
- é€šçŸ¥å‘é€: âœ… æˆåŠŸå‘é€
- é£žä¹¦é›†æˆ: âœ… æ­£å¸¸å·¥ä½œ
- ç¼–è¯‘æž„å»º: âœ… æ— é”™è¯¯

**å°±ç»ªç¨‹åº¦**: âœ… **å¯ä»¥ç«‹å³ä½¿ç”¨**

---

## ðŸŽ‰ æµ‹è¯•é€šè¿‡ï¼

ä½ çš„Process Trackerå·²ç»å®Œå…¨å‡†å¤‡å¥½ä½¿ç”¨äº†ï¼

**å¿«é€Ÿå¼€å§‹**:
```bash
# 1. å¯åŠ¨Web Dashboard
./process-tracker web

# 2. æˆ–å¯åŠ¨å®Œæ•´ç›‘æŽ§
./process-tracker start

# 3. è®¿é—®ç•Œé¢
# http://localhost:18080
```

---

*æµ‹è¯•å®Œæˆæ—¶é—´: 2025å¹´1æœˆ*  
*æµ‹è¯•å·¥å…·: test_webhook.go*  
*æµ‹è¯•ç»“æžœ: âœ… é€šè¿‡*
